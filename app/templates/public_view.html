{% extends "base.html" %}

{% block content %}

<br>

<!-- User account information -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h2 class="h5 mb-0">Public Profile</h2>
    </div>
    <div class="card-body">
        <p class="mb-2"><strong>Account Number:</strong> <span class="text-secondary">{{ user.id }}</span></p>
        <p class="mb-0"><strong>Name:</strong> <span class="text-secondary">{{ user.firstname }} {{ user.lastname }}</span></p>
    </div>
</div>

{% if is_seller %}
    <!-- Seller additional information -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h2 class="h5 mb-0">Seller Information</h2>
        </div>
        <div class="card-body">
            <p class="mb-2"><strong>Email:</strong> <span class="text-secondary">{{ user.email }}</span></p>
            <p class="mb-0"><strong>Address:</strong> <span class="text-secondary">{{ user.address }}</span></p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-light">
            <h2 class="h5 mb-0">Rating and Reviews</h2>
        </div>
        <div class="card-body">
            <p class="mb-2"><strong>Number of Reviews:</strong> {{ num_reviews }}</p>
            <p class="mb-0"><strong>Rating:</strong> 
                {% for i in range(5) %}
                    {% if i < avg_rating|int %}
                        <span class="text-warning">★</span>
                    {% else %}
                        <span class="text-secondary">☆</span>
                    {% endif %}
                {% endfor %}
                ({{ "%.1f"|format(avg_rating) }})
            <p>
        </div>
    </div>

    <div class="mt-3">
        {% if current_user.is_authenticated %}
            {% if user.has_review %}
                <a href="{{ url_for('reviews.edit_review', review_id=user.review_id) }}" class="btn btn-success btn-sm">
                    Edit My Review
                </a>
            {% elif user.has_purchased %}
                <a href="{{ url_for('reviews.write_seller_review', user_id=user.id) }}" class="btn btn-primary btn-sm">
                    Submit Review
                </a>
            {% else %}
                <span class="text-muted">Purchase required to review</span>
            {% endif %}
        {% endif %}
    </div>

    <br>

    <!-- Reviews Section -->
    <div>
        <h2>Reviews</h2>
        {% if reviews %}
            <table class="table table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>User</th>
                        <th>Rating</th>
                        <th>Review</th>
                        <th>Upvotes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for review in reviews %}
                        <tr>
                            <td>{{ review.user_firstname }} {{ review.user_lastname }}</td>
                            <td>{{ review.rating }}</td>
                            <td>{{ review.description }}</td>
                            <td>{{ review.num_upvotes }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Pagination -->
            {% if pagination.pages > 1 %}
            <nav aria-label="Review pagination">
                <ul class="pagination justify-content-center my-4">
                    <li class="page-item {% if pagination.page == 1 %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('users.public_view', id=user.id, page=pagination.page-1) }}" aria-label="Previous">
                            <span>&laquo;</span>
                        </a>
                    </li>

                    {% for page_num in range(1, pagination.pages + 1) %}
                        {% if page_num == 1 or 
                            page_num == pagination.pages or 
                            (page_num >= pagination.page - 2 and page_num <= pagination.page + 2) %}
                            <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                                <a class="page-link" href="{{ url_for('users.public_view', id=user.id, page=page_num) }}">{{ page_num }}</a>
                            </li>
                        {% elif page_num == pagination.page - 3 or page_num == pagination.page + 3 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        {% endif %}
                    {% endfor %}

                    <li class="page-item {% if pagination.page == pagination.pages %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('users.public_view', id=user.id, page=pagination.page+1) }}" aria-label="Next">
                            <span>&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
            {% endif %}
        {% else %}
            <p>No reviews available for this seller.</p>
        {% endif %}
    </div>
{% else %}
    <p>This user is not a seller.</p>
{% endif %}

{% endblock %}

