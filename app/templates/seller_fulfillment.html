{% extends "base.html" %}

{% block content %}

<h1>Order Fulfillment</h1>

<!-- back to inventory -->
<div style="margin-bottom: 20px;">
  <a href="{{ url_for('inventory.inventory') }}" class="btn btn-secondary" style="font-size: 1em; padding: 10px 20px;">
    Back to Inventory
  </a>
</div>

<!-- search for -->
<form method="GET" action="{{ url_for('fulfillment.seller_fulfillment') }}" style="margin-bottom: 20px;">
  <input type="text" name="search" placeholder="Search by product or buyer name" value="{{ search }}" style="width: 300px; padding: 8px;">
  <button type="submit" class="btn btn-primary" style="padding: 8px 20px;">Search</button>
</form>

<!-- loop throguh orders -->
{% if orders %}
  {% for order in orders %}
  <div class="order" style="border: 1px solid #ddd; padding: 20px; margin-bottom: 20px;">
      <h2>Order #{{ order.order_id }}</h2>
      <p><strong>Buyer:</strong> {{ order.items[0].buyer_name }}</p>
      <p><strong>Address:</strong> {{ order.items[0].buyer_address }}</p>
      <p><strong>Order Date:</strong> {{ order.time_created }}</p>
      <p><strong>Total Price:</strong> ${{ order.seller_total_price }}</p>
      <p><strong>Order Status:</strong> {{ 'Fulfilled' if order.overall_fulfilled else 'Pending' }}</p>

      <table class="table table-hover table-bordered">
          <thead>
              <tr>
                  <th>Product Name</th>
                  <th>Quantity</th>
                  <th>Fulfillment Status</th>
                  <th>Action</th>
              </tr>
          </thead>
          <tbody>
              {% for item in order.items %}
              <tr>
                  <td>{{ item.product_name }}</td>
                  <td>{{ item.quantity }}</td>
                  <td>{{ 'Fulfilled' if item.is_fulfilled else 'Pending' }}</td>
                  <td>
                      {% if not item.is_fulfilled %}
                      <form action="{{ url_for('fulfillment.fulfill_cartitem', cartitem_id=item.cartitem_id) }}" method="POST">
                          <button type="submit" class="btn btn-success">Mark as Fulfilled</button>
                      </form>
                      {% endif %}
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
  </div>
  {% endfor %}
{% else %}
  <p>No orders found matching your search.</p>
{% endif %}

{% endblock %}
